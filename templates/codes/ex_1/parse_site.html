{% block parse_site %}
<p class="mt-2">
    В коде присутствует статический <span class="help_translate">@staticmethod</span> метод
    <span class="help_translate">parse_site()</span>. С сервером он никак не взаимодействует
    и был написан для парсинга официального сайта ESPN, чтобы набрать некую базу игроков NBA.
</p>
<ol>
    <li>
        Для начала создается переменная <span class="help_translate">url</span>, куда в строковом
        типе передается ссылка на главную страницу сайта ESPN. Затем получаем ответ с помощью
        библиотеки <span class="help_translate">requests</span> и используем библиотеку
        <span class="help_translate">BeatifulSoup4</span>, чтобы получить тело ответа. <br><br>
    </li>
    <li>
        Получив тело ответа, создаем список, в который добавляем только те атрибуты ссылок
        (<span class="help_translate">needed_hrefs</span>), полученные из тела ответа
        (<span class="help_translate">response_body</span>), у которых в атрибуте
        <span class="help_translate">href</span> присутствует слово 'roster', т.к., переходя
        именно по этим ссылкам, можно сразу получить страницы со списком игроков каждой
        команды. <br><br>
    </li>
    <li>
        Далее создаем список колонок для <span class="help_translate">csv</span>-файла. Создаем
        DataFrame <span class="help_translate">df_w</span> (где w означает мод 'write' – запись),
        куда в качестве содержимого передаем сами колонки, которые запишем как как шапку для
        последующих строк и в качестве колонок – заготовленный список колонок. Затем записываем
        наш Header в файл. <br><br>
    </li>
    <li>
        Проходимся по всем атрибутам из парс-листа атрибутов и на каждой итерации создаем новый список 
        списков – <span class="help_translate">table-rows</span>. В каждый список добавляются все строки 
        таблиц с игроками из страниц, полученных с помощью <span class="help_translate">
        BeatifulSoup4</span>. Циклом перебирается каждая строка из таблицы, затем создается список со 
        всеми ячейками каждой строки. <br><br>
    </li>
    <li>
        Найдя все ячейки и упаковав их в список, можно получить каждый элемент, обратясь по индексу, т.к. 
        известно, сколько всего ячеек в каждой строке таблицы. Преобразовываем каждую ячейку в нормальный 
        вид (конвертация метрических единиц и валют в привычные нам и прочее) и упаковываем в новый список. 
        На каждой итерации прохождения по строкам создается DataFrame, туда в качестве содержимого 
        передается список отформатированных ячеек и в качестве колонок ранее созданный список колонок и в конце 
        строкой записывается в файл.
    </li>
</ol>

<div class="highlight" style="background: #fdf6e3; border-radius: 8px;border: 1px solid grey;padding: 15px">
    <pre
        style="line-height: 125%;"><span></span><span style="color: #268bd2">@staticmethod</span> 
<span style="color: #859900">def</span> <span style="color: #268bd2">parse_site</span><span style="color: #657b83">():</span> 
    <span style="color: #657b83">url:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #2aa198">&#39;https://www.espn.com&#39;</span> 
    <span style="color: #657b83">response</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">requests</span><span style="color: #93a1a1">.</span><span style="color: #657b83">get(url</span> <span style="color: #93a1a1">+</span> <span style="color: #2aa198">&#39;/nba/teams&#39;</span><span style="color: #657b83">)</span> 
    <span style="color: #657b83">response_body</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">bs(response</span><span style="color: #93a1a1">.</span><span style="color: #657b83">content,</span> <span style="color: #2aa198">&#39;html.parser&#39;</span><span style="color: #657b83">)</span> 
    <span style="color: #657b83">needed_hrefs:</span> <span style="color: #268bd2">list</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">[</span> 
        <span style="color: #657b83">link[</span><span style="color: #2aa198">&#39;href&#39;</span><span style="color: #657b83">]</span> <span style="color: #859900">for</span> <span style="color: #657b83">link</span> <span style="color: #859900">in</span> <span style="color: #657b83">response_body</span> 
        <span style="color: #93a1a1">.</span><span style="color: #657b83">find(</span><span style="color: #2aa198">&#39;div&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">{</span><span style="color: #2aa198">&#39;class&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;layout is-split&#39;</span><span style="color: #657b83">})</span> 
        <span style="color: #93a1a1">.</span><span style="color: #657b83">find_all(</span><span style="color: #2aa198">&#39;a&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">{</span><span style="color: #2aa198">&#39;class&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;AnchorLink&#39;</span><span style="color: #657b83">})</span> <span style="color: #859900">if</span> <span style="color: #2aa198">&#39;roster&#39;</span> <span style="color: #859900">in</span> <span style="color: #657b83">link[</span><span style="color: #2aa198">&#39;href&#39;</span><span style="color: #657b83">]</span> 
    <span style="color: #657b83">]</span> 
    <span style="color: #657b83">columns:</span> <span style="color: #268bd2">list</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">[</span><span style="color: #2aa198">&#39;Name&#39;</span><span style="color: #657b83">,</span> <span style="color: #2aa198">&#39;Position&#39;</span><span style="color: #657b83">,</span> <span style="color: #2aa198">&#39;Age&#39;</span><span style="color: #657b83">,</span> <span style="color: #2aa198">&#39;Height&#39;</span><span style="color: #657b83">,</span> <span style="color: #2aa198">&#39;Weight&#39;</span><span style="color: #657b83">,</span> <span style="color: #2aa198">&#39;Team&#39;</span><span style="color: #657b83">,</span> <span style="color: #2aa198">&#39;College&#39;</span><span style="color: #657b83">,</span> <span style="color: #2aa198">&#39;Salary&#39;</span><span style="color: #657b83">]</span> 
    <span style="color: #657b83">df_w</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">pd</span><span style="color: #93a1a1">.</span><span style="color: #657b83">DataFrame([columns],</span> <span style="color: #657b83">columns</span><span style="color: #93a1a1">=</span><span style="color: #657b83">columns)</span> 
    <span style="color: #657b83">df_w</span><span style="color: #93a1a1">.</span><span style="color: #657b83">to_csv(</span><span style="color: #2aa198">&#39;results/players.csv&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">mode</span><span style="color: #93a1a1">=</span><span style="color: #2aa198">&#39;w&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">index</span><span style="color: #93a1a1">=</span><span style="color: #2aa198">False</span><span style="color: #657b83">,</span> <span style="color: #657b83">header</span><span style="color: #93a1a1">=</span><span style="color: #2aa198">False</span><span style="color: #657b83">)</span> 
    <span style="color: #859900">for</span> <span style="color: #657b83">href</span> <span style="color: #859900">in</span> <span style="color: #657b83">needed_hrefs:</span> 
        <span style="color: #657b83">table_rows:</span> <span style="color: #268bd2">list</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">bs(requests</span><span style="color: #93a1a1">.</span><span style="color: #657b83">get(url</span> <span style="color: #93a1a1">+</span> <span style="color: #657b83">href)</span><span style="color: #93a1a1">.</span><span style="color: #657b83">content,</span> <span style="color: #2aa198">&#39;html.parser&#39;</span><span style="color: #657b83">)</span><span style="color: #2aa198"> \<span> 
            <span style="color: #93a1a1">.</span><span style="color: #657b83">find(</span><span style="color: #2aa198">&#39;tbody&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">{</span><span style="color: #2aa198">&#39;class&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;Table__TBODY&#39;</span><span style="color: #657b83">})</span><span style="color: #2aa198"> \<span> 
            <span style="color: #93a1a1">.</span><span style="color: #657b83">find_all(</span><span style="color: #2aa198">&#39;tr&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">{</span><span style="color: #2aa198">&#39;class&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;Table__TR&#39;</span><span style="color: #657b83">})</span> 
        <span style="color: #859900">for</span> <span style="color: #657b83">table_row</span> <span style="color: #859900">in</span> <span style="color: #657b83">table_rows:</span> 
            <span style="color: #657b83">table_datas:</span> <span style="color: #268bd2">list</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">table_row</span><span style="color: #93a1a1">.</span><span style="color: #657b83">find_all(</span><span style="color: #2aa198">&#39;td&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">{</span><span style="color: #2aa198">&#39;class&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;Table__TD&#39;</span><span style="color: #657b83">})</span> 
            <span style="color: #657b83">player_name:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #2aa198">&#39; &#39;</span><span style="color: #93a1a1">.</span><span style="color: #657b83">join(re</span><span style="color: #93a1a1">.</span><span style="color: #657b83">findall(</span><span style="color: #2aa198">&#39;[A-z.]+&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">table_datas[</span><span style="color: #2aa198">1</span><span style="color: #657b83">]</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text))</span> 
            <span style="color: #657b83">player_role:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">table_datas[</span><span style="color: #2aa198">2</span><span style="color: #657b83">]</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text</span> <span style="color: #657b83">player_age:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">table_datas[</span><span style="color: #2aa198">3</span><span style="color: #657b83">]</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text</span> 
            <span style="color: #657b83">player_height:</span> <span style="color: #268bd2">int</span> <span style="color: #93a1a1">=</span> <span style="color: #268bd2">round</span><span style="color: #657b83">(Length(</span><span style="color: #268bd2">float</span><span style="color: #657b83">(</span><span style="color: #2aa198">&#39;.&#39;</span><span style="color: #93a1a1">.</span><span style="color: #657b83">join(re</span><span style="color: #93a1a1">.</span><span style="color: #657b83">findall(</span><span style="color: #2aa198">r&#39;[1-9]+&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">table_datas[</span><span style="color: #2aa198">4</span><span style="color: #657b83">]</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text))),</span> <span style="color: #657b83">LengthUnits</span><span style="color: #93a1a1">.</span><span style="color: #657b83">Foot)</span><span style="color: #93a1a1">.</span><span style="color: #657b83">centimeters)</span> 
            <span style="color: #657b83">player_weight:</span> <span style="color: #268bd2">int</span> <span style="color: #93a1a1">=</span> <span style="color: #268bd2">round</span><span style="color: #657b83">(Mass(</span><span style="color: #268bd2">int</span><span style="color: #657b83">(re</span><span style="color: #93a1a1">.</span><span style="color: #657b83">findall(</span><span style="color: #2aa198">r&#39;[0-9]+&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">table_datas[</span><span style="color: #2aa198">5</span><span style="color: #657b83">]</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text)[</span><span style="color: #2aa198">0</span><span style="color: #657b83">]),</span> <span style="color: #657b83">MassUnits</span><span style="color: #93a1a1">.</span><span style="color: #657b83">Pound)</span><span style="color: #93a1a1">.</span><span style="color: #657b83">kilograms)</span> 
            <span style="color: #657b83">player_team:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #2aa198">&#39; &#39;</span><span style="color: #93a1a1">.</span><span style="color: #657b83">join(</span> 
                <span style="color: #657b83">[</span> 
                    <span style="color: #657b83">team</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text</span> <span style="color: #859900">for</span> <span style="color: #657b83">team</span> <span style="color: #859900">in</span> <span style="color: #657b83">bs(requests</span><span style="color: #93a1a1">.</span><span style="color: #657b83">get(url</span> <span style="color: #93a1a1">+</span> <span style="color: #657b83">href)</span><span style="color: #93a1a1">.</span><span style="color: #657b83">content,</span> <span style="color: #2aa198">&#39;html.parser&#39;</span><span style="color: #657b83">)</span> 
                    <span style="color: #93a1a1">.</span><span style="color: #657b83">find(</span><span style="color: #2aa198">&#39;main&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">{</span><span style="color: #2aa198">&#39;id&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;fittPageContainer&#39;</span><span style="color: #657b83">})</span> 
                    <span style="color: #93a1a1">.</span><span style="color: #657b83">find(</span><span style="color: #2aa198">&#39;h1&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">{</span><span style="color: #2aa198">&#39;class&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;ClubhouseHeader__Name&#39;</span><span style="color: #657b83">})</span> 
                    <span style="color: #93a1a1">.</span><span style="color: #657b83">find_all(</span><span style="color: #2aa198">&#39;span&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">{</span><span style="color: #2aa198">&#39;class&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;db&#39;</span><span style="color: #657b83">})</span> 
                <span style="color: #657b83">]</span> 
            <span style="color: #657b83">)</span> 
            <span style="color: #657b83">player_info_unknown:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #2aa198">&#39;Неизвестно&#39;</span> 
            <span style="color: #657b83">player_education:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">player_info_unknown</span> <span style="color: #859900">if</span> <span style="color: #657b83">re</span><span style="color: #93a1a1">.</span><span style="color: #657b83">search(</span><span style="color: #2aa198">r&#39;-&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">table_datas[</span><span style="color: #2aa198">6</span><span style="color: #657b83">]</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text)</span> <span style="color: #859900">else</span> <span style="color: #657b83">table_datas[</span><span style="color: #2aa198">6</span><span style="color: #657b83">]</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text</span> 
            <span style="color: #657b83">player_salary_usd:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #2aa198">&#39;&#39;</span><span style="color: #93a1a1">.</span><span style="color: #657b83">join(</span><span style="color: #2aa198">&#39;&#39;</span><span style="color: #93a1a1">.</span><span style="color: #657b83">join(re</span><span style="color: #93a1a1">.</span><span style="color: #657b83">findall(</span><span style="color: #2aa198">r&#39;[0-9,]+&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">table_datas[</span><span style="color: #2aa198">7</span><span style="color: #657b83">]</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text))</span><span style="color: #93a1a1">.</span><span style="color: #657b83">split(</span><span style="color: #2aa198">&#39;,&#39;</span><span style="color: #657b83">))</span> 
            <span style="color: #657b83">player_salary:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">player_info_unknown</span> <span style="color: #2aa198">\<span> 
                <span style="color: #859900">if</span> <span style="color: #657b83">re</span><span style="color: #93a1a1">.</span><span style="color: #657b83">search(</span><span style="color: #2aa198">r&#39;-&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">table_datas[</span><span style="color: #2aa198">7</span><span style="color: #657b83">]</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text)</span> <span style="color: #2aa198">\<span> 
                <span style="color: #859900">else</span> <span style="color: #268bd2">round</span><span style="color: #657b83">(cc(fallback_on_wrong_date</span><span style="color: #93a1a1">=</span><span style="color: #2aa198">True</span><span style="color: #657b83">)</span><span style="color: #93a1a1">.</span><span style="color: #657b83">convert(</span><span style="color: #268bd2">int</span><span style="color: #657b83">(player_salary_usd),</span> <span style="color: #2aa198">&#39;USD&#39;</span><span style="color: #657b83">,</span> <span style="color: #2aa198">&#39;RUB&#39;</span><span style="color: #657b83">)</span> <span style="color: #93a1a1">/</span> <span style="color: #2aa198">1000000</span><span style="color: #657b83">)</span> 
            <span style="color: #657b83">player_info_list:</span> <span style="color: #268bd2">list</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">[</span> 
                <span style="color: #657b83">player_name,</span> <span style="color: #657b83">player_role,</span> <span style="color: #657b83">player_age,</span> <span style="color: #657b83">player_height,</span> 
                <span style="color: #657b83">player_weight,</span> <span style="color: #657b83">player_team,</span> <span style="color: #657b83">player_education,</span> <span style="color: #657b83">player_salary</span> 
            <span style="color: #657b83">]</span> 
            <span style="color: #657b83">df_a</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">pd</span><span style="color: #93a1a1">.</span><span style="color: #657b83">DataFrame([player_info_list],</span> <span style="color: #657b83">columns</span><span style="color: #93a1a1">=</span><span style="color: #657b83">columns)</span> 
            <span style="color: #657b83">df_a</span><span style="color: #93a1a1">.</span><span style="color: #657b83">to_csv(</span><span style="color: #2aa198">&#39;results/players.csv&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">mode</span><span style="color: #93a1a1">=</span><span style="color: #2aa198">&#39;a&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">index</span><span style="color: #93a1a1">=</span><span style="color: #2aa198">False</span><span style="color: #657b83">,</span> <span style="color: #657b83">header</span><span style="color: #93a1a1">=</span><span style="color: #2aa198">False</span><span style="color: #657b83">)</span></pre>
</div>
{% endblock %}