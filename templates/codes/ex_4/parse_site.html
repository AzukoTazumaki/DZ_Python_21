{% block parse_site %}
<div class="row d-flex align-items-center justify-content-between code_description mt-4">
    <div class="col-5">
        <h5>Метод парсинга книг</h5>
        <hr>
        <p class="mt-3">
            Метод парсинга книг <span class="help_translate">parse_site()</span> идентичен 
            парсингу из задания с баскетболистами. Сначала создаем <span class="help_translate">url</span> 
            с ссылкой на сайт. Затем создаем список с атрибутами ссылок жанров с помощью генератора списка, 
            вместе с этим создав список колонок, который в последующем используется библиотекой 
            <span class="help_translate">pandas</span>. Создаем <span class="help_translate">DataFrame</span>, 
            куда передаем список колонок, записываем в файл в качестве шапки, используя mode='w', так как требуется 
            перезаписать файл.
            Далее циклом проходимся по всем атрибутам из списка <span class="help_translate">needed_hrefs</span>. 
            На каждой итерации создаем множество ссылок на каждую из книг. В данном случае сделал не список, а 
            множество, так как на сайте присутствовали дубликаты, а множество убирает дубликаты, делая каждый его 
            элемент уникальным. На этой же итерации создаем новый цикл, в котором прохимся по каждой из ссылок на книги, 
            и уже на каждой из этих итераций получаем тело страницы, где находим все нужные нам сведения: Название, Автор, 
            Жанр, Год, Издательство и Краткое содержание, создаем список с найденными сведениями, создаем 
            <span class="help_translate">DataFrame</span>, куда передаем список колонок, и записываем в файл, используя mode='a', 
            чтобы не перезаписывать файл, а построчно добавлять информацию о книгах в конец файла. После вызова цикла по ссылкам 
            на книги стоит <span class="help_translate">try</span>. Это сделано в связи с возможными ошибками парсинга, так как не все 
            нужные сведения на странице имеют атрибуты. Если проверка не проходит, вызывается исключение <span class="help_translate">
            AttributeError</span>, в котором говорится переходить на следующие итерацию, пропуская нынешнюю.
        </p>
    </div>
    <div class="col-7">
        <div class="highlight" style="background: #fdf6e3; border-radius: 8px;border: 1px solid grey;padding: 15px"><pre style="line-height: 125%;"><span></span>
<span style="color: #268bd2">@staticmethod</span> 
<span style="color: #859900">def</span> <span style="color: #268bd2">parse_site</span><span style="color: #657b83">():</span> 
    <span style="color: #657b83">url:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #2aa198">&#39;https://libcat.ru/&#39;</span> 
    <span style="color: #657b83">columns:</span> <span style="color: #268bd2">list</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">[</span><span style="color: #2aa198">&#39;Title&#39;</span><span style="color: #657b83">,</span> <span style="color: #2aa198">&#39;Author&#39;</span><span style="color: #657b83">,</span> <span style="color: #2aa198">&#39;Genre&#39;</span><span style="color: #657b83">,</span> <span style="color: #2aa198">&#39;Year&#39;</span><span style="color: #657b83">,</span> <span style="color: #2aa198">&#39;Publisher&#39;</span><span style="color: #657b83">,</span> <span style="color: #2aa198">&#39;Summary&#39;</span><span style="color: #657b83">]</span> 
    <span style="color: #657b83">needed_hrefs:</span> <span style="color: #268bd2">list</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">[</span> 
        <span style="color: #657b83">link[</span><span style="color: #2aa198">&#39;href&#39;</span><span style="color: #657b83">]</span> <span style="color: #859900">for</span> <span style="color: #657b83">link</span> <span style="color: #859900">in</span> <span style="color: #657b83">bs(requests</span><span style="color: #93a1a1">.</span><span style="color: #657b83">get(url)</span><span style="color: #93a1a1">.</span><span style="color: #657b83">content,</span> <span style="color: #2aa198">&#39;html.parser&#39;</span><span style="color: #657b83">)</span> 
        <span style="color: #93a1a1">.</span><span style="color: #657b83">find_all(</span><span style="color: #2aa198">&#39;a&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">{</span><span style="color: #2aa198">&#39;class&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;tag&#39;</span><span style="color: #657b83">})</span> 
    <span style="color: #657b83">]</span> 
    <span style="color: #657b83">df_w</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">pd</span><span style="color: #93a1a1">.</span><span style="color: #657b83">DataFrame([columns],</span> <span style="color: #657b83">columns</span><span style="color: #93a1a1">=</span><span style="color: #657b83">columns)</span> 
    <span style="color: #657b83">df_w</span><span style="color: #93a1a1">.</span><span style="color: #657b83">to_csv(</span><span style="color: #2aa198">&#39;results/books.csv&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">mode</span><span style="color: #93a1a1">=</span><span style="color: #2aa198">&#39;w&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">index</span><span style="color: #93a1a1">=</span><span style="color: #2aa198">False</span><span style="color: #657b83">,</span> <span style="color: #657b83">header</span><span style="color: #93a1a1">=</span><span style="color: #2aa198">False</span><span style="color: #657b83">)</span> 
    <span style="color: #859900">for</span> <span style="color: #657b83">href</span> <span style="color: #859900">in</span> <span style="color: #657b83">needed_hrefs:</span> 
        <span style="color: #657b83">links:</span> <span style="color: #268bd2">set</span> <span style="color: #93a1a1">=</span> <span style="color: #268bd2">set</span><span style="color: #657b83">([</span> 
            <span style="color: #657b83">link[</span><span style="color: #2aa198">&#39;href&#39;</span><span style="color: #657b83">]</span> <span style="color: #859900">for</span> <span style="color: #657b83">link</span> <span style="color: #859900">in</span> <span style="color: #657b83">bs(requests</span><span style="color: #93a1a1">.</span><span style="color: #657b83">get(url</span> <span style="color: #93a1a1">+</span> <span style="color: #657b83">href)</span><span style="color: #93a1a1">.</span><span style="color: #657b83">content,</span> <span style="color: #2aa198">&#39;html.parser&#39;</span><span style="color: #657b83">)</span> 
            <span style="color: #93a1a1">.</span><span style="color: #657b83">find(</span><span style="color: #2aa198">&#39;div&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">{</span><span style="color: #2aa198">&#39;id&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;dle-content&#39;</span><span style="color: #657b83">})</span> 
            <span style="color: #93a1a1">.</span><span style="color: #657b83">find_all(</span><span style="color: #2aa198">&#39;a&#39;</span><span style="color: #657b83">)</span> <span style="color: #859900">if</span> <span style="color: #2aa198">&#39;page&#39;</span> <span style="color: #859900">not</span> <span style="color: #859900">in</span> <span style="color: #657b83">link[</span><span style="color: #2aa198">&#39;href&#39;</span><span style="color: #657b83">]</span> 
        <span style="color: #657b83">])</span> 
        <span style="color: #859900">for</span> <span style="color: #657b83">link</span> <span style="color: #859900">in</span> <span style="color: #657b83">links:</span> 
            <span style="color: #859900">try</span><span style="color: #657b83">:</span> 
                <span style="color: #657b83">book_page</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">bs(requests</span><span style="color: #93a1a1">.</span><span style="color: #657b83">get(link)</span><span style="color: #93a1a1">.</span><span style="color: #657b83">content,</span> <span style="color: #2aa198">&#39;html.parser&#39;</span><span style="color: #657b83">)</span> 
                <span style="color: #657b83">title_of_book:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">book_page</span><span style="color: #93a1a1">.</span><span style="color: #657b83">find(</span><span style="color: #2aa198">&#39;div&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">attrs</span><span style="color: #93a1a1">=</span><span style="color: #657b83">{</span><span style="color: #2aa198">&#39;itemprop&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;name&#39;</span><span style="color: #657b83">})</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text</span> 
                <span style="color: #657b83">author_of_book:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">book_page</span><span style="color: #93a1a1">.</span><span style="color: #657b83">find(</span><span style="color: #2aa198">&#39;a&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">attrs</span><span style="color: #93a1a1">=</span><span style="color: #657b83">{</span><span style="color: #2aa198">&#39;itemprop&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;author&#39;</span><span style="color: #657b83">})</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text</span> 
                <span style="color: #657b83">genre_of_book:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">book_page</span><span style="color: #93a1a1">.</span><span style="color: #657b83">find(</span><span style="color: #2aa198">&#39;a&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">attrs</span><span style="color: #93a1a1">=</span><span style="color: #657b83">{</span><span style="color: #2aa198">&#39;itemprop&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;genre&#39;</span><span style="color: #657b83">})</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text</span> 
                <span style="color: #657b83">year_of_book:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">book_page</span><span style="color: #93a1a1">.</span><span style="color: #657b83">find(</span><span style="color: #2aa198">&#39;div&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">attrs</span><span style="color: #93a1a1">=</span><span style="color: #657b83">{</span><span style="color: #2aa198">&#39;itemprop&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;copyrightYear&#39;</span><span style="color: #657b83">})</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text</span> 
                <span style="color: #657b83">publisher_of_book:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">book_page</span><span style="color: #93a1a1">.</span><span style="color: #657b83">find(</span><span style="color: #2aa198">&#39;div&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">attrs</span><span style="color: #93a1a1">=</span><span style="color: #657b83">{</span><span style="color: #2aa198">&#39;itemprop&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;publisher&#39;</span><span style="color: #657b83">})</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text</span> 
                <span style="color: #657b83">summary_of_book:</span> <span style="color: #268bd2">str</span> <span style="color: #93a1a1">=</span> <span style="color: #2aa198">&#39;Неизвестно&#39;</span> <span style="color: #859900">if</span> <span style="color: #2aa198">&#39;&#39;</span> <span style="color: #93a1a1">==</span> <span style="color: #657b83">book_page</span><span style="color: #93a1a1">.</span><span style="color: #657b83">find(</span><span style="color: #2aa198">&#39;div&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">attrs</span><span style="color: #93a1a1">=</span><span style="color: #657b83">{</span><span style="color: #2aa198">&#39;itemprop&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;about&#39;</span><span style="color: #657b83">})</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text</span> \ 
                    <span style="color: #859900">else</span> <span style="color: #657b83">book_page</span><span style="color: #93a1a1">.</span><span style="color: #657b83">find(</span><span style="color: #2aa198">&#39;div&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">attrs</span><span style="color: #93a1a1">=</span><span style="color: #657b83">{</span><span style="color: #2aa198">&#39;itemprop&#39;</span><span style="color: #657b83">:</span> <span style="color: #2aa198">&#39;about&#39;</span><span style="color: #657b83">})</span><span style="color: #93a1a1">.</span><span style="color: #657b83">text</span> 
                <span style="color: #657b83">book_info:</span> <span style="color: #268bd2">list</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">[</span> 
                    <span style="color: #657b83">title_of_book,</span> <span style="color: #657b83">author_of_book,</span> <span style="color: #657b83">genre_of_book,</span> 
                    <span style="color: #657b83">year_of_book,</span> <span style="color: #657b83">publisher_of_book,</span> <span style="color: #657b83">summary_of_book</span> 
                <span style="color: #657b83">]</span> 
                <span style="color: #657b83">df_a</span> <span style="color: #93a1a1">=</span> <span style="color: #657b83">pd</span><span style="color: #93a1a1">.</span><span style="color: #657b83">DataFrame([book_info],</span> <span style="color: #657b83">columns</span><span style="color: #93a1a1">=</span><span style="color: #657b83">columns)</span> 
                <span style="color: #657b83">df_a</span><span style="color: #93a1a1">.</span><span style="color: #657b83">to_csv(</span><span style="color: #2aa198">&#39;results/books.csv&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">mode</span><span style="color: #93a1a1">=</span><span style="color: #2aa198">&#39;a&#39;</span><span style="color: #657b83">,</span> <span style="color: #657b83">index</span><span style="color: #93a1a1">=</span><span style="color: #2aa198">False</span><span style="color: #657b83">,</span> <span style="color: #657b83">header</span><span style="color: #93a1a1">=</span><span style="color: #2aa198">False</span><span style="color: #657b83">)</span> 
            <span style="color: #859900">except</span> <span style="color: #268bd2">AttributeError</span><span style="color: #657b83">:</span> 
                <span style="color: #859900">continue</span></pre></div>
    </div>
</div>
{% endblock %}